# Complete .ENV Setup Guide for PolyChat

You need to set up 3 `.env` files in different locations. Here's the complete breakdown:

---

## 1ï¸âƒ£ ROOT `.env` (for contracts/deployment)

**Location:** `polygon/.env`

**File:**
```dotenv
# ===== Polygon Amoy Testnet (Smart Contract Deployment) =====
AMOY_RPC_URL=https://polygon-amoy.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
DEPLOYER_PRIVATE_KEY=your_private_key_here
ETHERSCAN_API_KEY=your_etherscan_api_key

# ===== File Storage (Lighthouse) =====
LIGHTHOUSE_API_KEY=your_lighthouse_api_key

# ===== Frontend URLs (Public, exposed in browser) =====
NEXT_PUBLIC_AMOY_RPC_URL=https://polygon-amoy.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
NEXT_PUBLIC_CHAT_REGISTRY_ADDRESS=0x32593a5A622baC68B58A19315A55eF9e785C9F0E
NEXT_PUBLIC_SOCKET_URL=http://localhost:3001
NEXT_PUBLIC_LIGHTHOUSE_GATEWAY=https://gateway.lighthouse.storage/ipfs
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=demo
```

**What Each Variable Does:**
| Variable | Purpose | Where Used |
|----------|---------|-----------|
| `AMOY_RPC_URL` | Connect to Polygon Amoy testnet | Smart contract deployment |
| `DEPLOYER_PRIVATE_KEY` | Private key for contract deployment | Hardhat scripts |
| `ETHERSCAN_API_KEY` | Verify contracts on Etherscan | Contract verification |
| `LIGHTHOUSE_API_KEY` | Upload files to IPFS via Lighthouse | Backend/Server |
| `NEXT_PUBLIC_*` | Public variables (visible in browser) | Web frontend |

---

## 2ï¸âƒ£ WEB `.env.local` (frontend configuration)

**Location:** `polygon/web/.env.local`

**File:**
```dotenv
# ===== Blockchain Configuration (Public - Browser Visible) =====
NEXT_PUBLIC_AMOY_RPC_URL=https://polygon-amoy.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
NEXT_PUBLIC_CHAT_REGISTRY_ADDRESS=0x32593a5A622baC68B58A19315A55eF9e785C9F0E
NEXT_PUBLIC_SOCKET_URL=http://localhost:3001
NEXT_PUBLIC_LIGHTHOUSE_GATEWAY=https://gateway.lighthouse.storage/ipfs
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=demo

# ===== File Storage API Key (Private - Not exposed in browser) =====
LIGHTHOUSE_API_KEY=your_lighthouse_api_key
```

**Notes:**
- Variables starting with `NEXT_PUBLIC_` are visible in the browser (client-side)
- Variables WITHOUT `NEXT_PUBLIC_` are private (server-side only)
- This file is gitignored (not pushed to GitHub)

---

## 3ï¸âƒ£ REALTIME SERVER `.env` (Socket.io server)

**Location:** `polygon/realtime-server/.env`

**File:**
```dotenv
# ===== Server Configuration =====
PORT=3001
NODE_ENV=development

# ===== CORS Configuration =====
CORS_ORIGIN=http://localhost:3000

# ===== Optional: Add Database or Auth =====
# DATABASE_URL=your_database_url
# JWT_SECRET=your_jwt_secret
```

**What Each Variable Does:**
| Variable | Purpose | Default |
|----------|---------|---------|
| `PORT` | Server port (localhost:PORT) | 3001 |
| `NODE_ENV` | Environment (development/production) | development |
| `CORS_ORIGIN` | Allow requests from frontend URL | http://localhost:3000 |

---

## ðŸš€ Quick Setup Commands

### Step 1: Create Root `.env`
```bash
cd polygon
cat > .env << 'EOF'
AMOY_RPC_URL=https://polygon-amoy.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
DEPLOYER_PRIVATE_KEY=your_private_key_here
ETHERSCAN_API_KEY=your_etherscan_api_key
LIGHTHOUSE_API_KEY=your_lighthouse_api_key
NEXT_PUBLIC_AMOY_RPC_URL=https://polygon-amoy.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
NEXT_PUBLIC_CHAT_REGISTRY_ADDRESS=0x32593a5A622baC68B58A19315A55eF9e785C9F0E
NEXT_PUBLIC_SOCKET_URL=http://localhost:3001
NEXT_PUBLIC_LIGHTHOUSE_GATEWAY=https://gateway.lighthouse.storage/ipfs
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=demo
EOF
```

### Step 2: Create Web `.env.local`
```bash
cat > web/.env.local << 'EOF'
NEXT_PUBLIC_AMOY_RPC_URL=https://polygon-amoy.g.alchemy.com/v2/YOUR_ALCHEMY_KEY
NEXT_PUBLIC_CHAT_REGISTRY_ADDRESS=0x32593a5A622baC68B58A19315A55eF9e785C9F0E
NEXT_PUBLIC_SOCKET_URL=http://localhost:3001
NEXT_PUBLIC_LIGHTHOUSE_GATEWAY=https://gateway.lighthouse.storage/ipfs
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID=demo
LIGHTHOUSE_API_KEY=your_lighthouse_api_key
EOF
```

### Step 3: Create Realtime Server `.env`
```bash
cat > realtime-server/.env << 'EOF'
PORT=3001
NODE_ENV=development
CORS_ORIGIN=http://localhost:3000
EOF
```

---

## ðŸ“‹ Where to Get Values

### `AMOY_RPC_URL` & `NEXT_PUBLIC_AMOY_RPC_URL`
1. Go to [Alchemy.com](https://www.alchemy.com/)
2. Create an account â†’ Create an app
3. Select **Polygon Amoy** network
4. Copy the HTTPS URL

### `DEPLOYER_PRIVATE_KEY`
1. Export from MetaMask / wallet
2. **âš ï¸ NEVER commit this to GitHub!**
3. Keep it secret and safe

### `ETHERSCAN_API_KEY`
1. Go to [Etherscan Polygonscan](https://polygonscan.com/)
2. Sign up â†’ My Account â†’ API Keys
3. Create a new API key

### `LIGHTHOUSE_API_KEY`
1. Go to [Lighthouse Storage](https://www.lighthouse.storage/)
2. Sign up â†’ Dashboard
3. Copy your API key

### `NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID`
1. Go to [WalletConnect Cloud](https://cloud.walletconnect.com/)
2. Create a new project
3. Copy Project ID (can use "demo" for testing)

### `NEXT_PUBLIC_CHAT_REGISTRY_ADDRESS`
- Deploy your smart contract first (see `contracts/`)
- Copy the deployed contract address from the deployment output

---

## ðŸ”’ Production `.env` Setup (Vercel & Heroku)

### For Vercel (Web Frontend)
Go to **Vercel Dashboard** â†’ Your Project â†’ **Settings** â†’ **Environment Variables**

Add:
```
NEXT_PUBLIC_AMOY_RPC_URL = your_production_rpc_url
NEXT_PUBLIC_CHAT_REGISTRY_ADDRESS = deployed_contract_address
NEXT_PUBLIC_SOCKET_URL = https://your-realtime-server.com
NEXT_PUBLIC_LIGHTHOUSE_GATEWAY = https://gateway.lighthouse.storage/ipfs
NEXT_PUBLIC_WALLETCONNECT_PROJECT_ID = your_project_id
LIGHTHOUSE_API_KEY = your_api_key
```

### For Heroku (Realtime Server)
```bash
heroku config:set PORT=3001
heroku config:set NODE_ENV=production
heroku config:set CORS_ORIGIN=https://your-vercel-domain.vercel.app
```

---

## âœ… Verification Checklist

- [ ] Root `.env` created at `polygon/.env`
- [ ] Web `.env.local` created at `polygon/web/.env.local`
- [ ] Realtime Server `.env` created at `polygon/realtime-server/.env`
- [ ] All API keys filled in (Alchemy, Etherscan, Lighthouse, WalletConnect)
- [ ] `NEXT_PUBLIC_SOCKET_URL` points to your server (localhost for dev, domain for prod)
- [ ] `.env` files are in `.gitignore` (not committed to GitHub)
- [ ] Run `npm run dev` to test locally

---

## ðŸ› Troubleshooting

**Web can't connect to server?**
- Check `NEXT_PUBLIC_SOCKET_URL` matches realtime-server URL
- Ensure `CORS_ORIGIN` in realtime-server `.env` allows the web URL

**Smart contract calls failing?**
- Verify `AMOY_RPC_URL` is correct
- Check `NEXT_PUBLIC_CHAT_REGISTRY_ADDRESS` is the deployed contract address
- Ensure wallet is connected to Polygon Amoy testnet

**Files not uploading to IPFS?**
- Verify `LIGHTHOUSE_API_KEY` is correct
- Check Lighthouse account has enough storage credit

---

Done! You now have all 3 `.env` files configured. Run:
```bash
npm run dev
```
to start both web and server locally.
