# Realtime Server - Do You Need It?

## What Does the Realtime Server Do?

The `realtime-server` (Socket.io) handles **real-time communication** between users:

### Features It Provides:
| Feature | How It Works | Status |
|---------|-------------|--------|
| **Live Messaging** | Messages broadcast instantly between chat users (not stored) | ✅ REQUIRED |
| **Video/Audio Calls** | WebRTC offer/answer/ICE candidate negotiation | ✅ REQUIRED |
| **Conversation Rooms** | Groups users into chat "rooms" for multi-person conversations | ✅ REQUIRED |
| **Read Receipts** | Shows when messages have been read by other users | ✅ REQUIRED |
| **Presence** | Shows who is online/offline | ✅ REQUIRED |

---

## Can You Host ONLY the Web Without the Realtime Server?

### ❌ **NO** - The App Will NOT Work Properly

**What happens if you skip the realtime server:**

```
✗ Users can't send/receive messages in real-time
✗ Video/audio calls won't work at all
✗ No live notifications
✗ No read receipts
✗ No presence indicators (online/offline)
✗ App will show connection errors
```

**The web app actively tries to connect to the realtime server:**
```typescript
// web/src/lib/socket.ts
const SOCKET_URL = process.env.NEXT_PUBLIC_SOCKET_URL || "http://localhost:3001";
socket = io(SOCKET_URL);  // Tries to connect on page load
```

If the server is down or unreachable, users will see errors and can't use chat/call features.

---

## Architecture Overview

```
┌─────────────────────────────────────────┐
│  Vercel (Web Frontend - Next.js)        │
│  - UI Components                        │
│  - Smart Contract Interactions          │
│  - User Profiles                        │
└────────────┬────────────────────────────┘
             │ (WebSocket)
             │ NEXT_PUBLIC_SOCKET_URL
             ↓
┌─────────────────────────────────────────┐
│  Realtime Server (Socket.io)            │
│  - Live Messaging                       │
│  - Video/Audio Call Signaling           │
│  - Presence/Online Status               │
│  - Read Receipts                        │
└─────────────────────────────────────────┘
```

**Both are REQUIRED for a functional chat app.**

---

## Hosting Strategy

### Option 1: Host BOTH (Complete App) ✅ RECOMMENDED

| Component | Hosting | Setup |
|-----------|---------|-------|
| **Web** | Vercel | `npm run deploy:web` |
| **Realtime Server** | Heroku / Railway / Render | Manual setup |
| **Smart Contracts** | Polygon Amoy (Blockchain) | Deploy once with `hardhat` |

**You get:** Full chat + calls + messaging

---

### Option 2: Host ONLY Web (Limited App) ⚠️ NOT RECOMMENDED

If you host only the web:
- ❌ **Chat messages won't work** (no real-time delivery)
- ❌ **Video calls won't work** (can't exchange WebRTC signals)
- ❌ **App is broken**

**Not a viable option for a chat application.**

---

## How to Host the Realtime Server

### Free/Cheap Options (Pick One):

#### 1. **Heroku** (Free tier available)
```bash
cd realtime-server
heroku create your-app-name
git push heroku main
```
Cost: Free (with limitations) or ~$7/month

#### 2. **Railway.app** (Modern, Affordable)
```bash
railway init
railway deploy
```
Cost: ~$5-10/month for hobby tier

#### 3. **Render.com** (Easy setup)
- Connect GitHub repo
- Select `realtime-server` directory
- Auto-deploys on push

Cost: Free tier available or ~$7/month

#### 4. **Your Own VPS** (DigitalOcean, AWS, Linode)
```bash
ssh user@your-server.com
git clone your-repo
cd realtime-server
npm install
npm start
```
Cost: ~$5-20/month

---

## Production Setup (Complete)

### 1. Deploy Web to Vercel
```bash
npm run deploy:web
```

### 2. Deploy Realtime Server (pick one above)
Example with Railway:
```bash
cd realtime-server
railway init
railway deploy
```

### 3. Update Web `.env` in Vercel Dashboard
```
NEXT_PUBLIC_SOCKET_URL=https://your-realtime-server.railway.app
```

Now both are live and connected!

---

## Testing

### Test Locally First
```bash
# Terminal 1: Start realtime server
npm run server:dev

# Terminal 2: Start web app
npm run web:dev

# Open browser: http://localhost:3000
# Test: Send a message → Should appear instantly
```

### Test After Production Deployment
1. Go to your Vercel app
2. Open browser console (F12)
3. Check Network tab → WebSocket connection to realtime server
4. Send a message → Should work instantly

---

## Summary

| Question | Answer |
|----------|--------|
| **Do I need the realtime server?** | **YES - Absolutely required** |
| **Can I skip it?** | **NO - App won't work** |
| **Can I host only web?** | **NO - It's a chat app** |
| **Where to host server?** | Railway, Heroku, Render, or your own server |
| **Cost?** | ~$5-10/month for both web (Vercel free) + server |

**Bottom line:** You MUST host both the web and the realtime server for the app to work. They are **tightly integrated**.
